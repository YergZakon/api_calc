# Поля API и допустимые значения

Документ описывает все поля входного и выходного JSON для сервиса наказаний
(`POST /calculate`, `GET /api/article/`, `GET /reference/status`, `POST /reference/reload`, `GET /health`).

## Общие правила формата
- Все запросы/ответы — JSON.
- Даты — строка в формате `YYYY-MM-DD`.
- Коды справочников передавать строками (важны ведущие нули).
- Если поле не указано, используется значение по умолчанию (см. ниже).

---

## POST `/calculate`

### Вход (request)

#### Верхний уровень
- `lang` — язык ответа. Допустимо: `ru`. По умолчанию `ru`.
- `calc_date` — дата расчёта (внутренние конвертации месяцев/дней). Формат `YYYY-MM-DD`.
  По умолчанию — текущая дата сервера.
- `person` — объект с данными лица. Обязателен.
- `crime` — объект с данными преступления. Обязателен.

#### `person`
- `birth_date` — дата рождения. Формат `YYYY-MM-DD`. По умолчанию `null`.
- `gender` — пол. Допустимые значения:
  - `"1"` — мужской
  - `"2"` — женский
  Также допускаются значения: `male`, `female`, `жен`, `женщина`.
  По умолчанию `"1"`.
- `citizenship` — гражданство (строковый код):
  - `"1"` гражданин РК
  - `"2"` гражданин СНГ
  - `"3"` лицо без гражданства
  - `"4"` иностранный дипломат
  - `"5"` иностранец
- `dependents` — коды из `FS1R21P1` (иждивенцы), строка через запятую.
  Пример: `"02,04"`.
- `additional_marks` — коды из `FS1R231P1`, строка через запятую.
  Пример: `"85,90"`.
- `fs1r041p1`, `fs1r042p1` — спец‑процедуры (коды формы). Значимые значения: `"1"`, `"3"`.
- `fs1r23p1`, `fs1r26p1` — коды форм `FS1R23P1` и `FS1R26P1`.
- `is_recidivist`, `has_plea_agreement`, `special_status`, `conviction_type` — зарезервированы,
  **в текущей реализации не используются**.

#### `crime`
- `crime_date` — дата преступления. Формат `YYYY-MM-DD`.
  По умолчанию — текущая дата сервера.
- `article_code` — 7‑значный код статьи `AAASSPP` (пример: `"0990001"`).
  Если передано 5 цифр — используется как есть, но корректный формат — **7 цифр**.
- `article` — номер статьи, если `article_code` не указан. Пример: `"188"` или `"188-1"`.
- `part` — часть статьи, если код строится из `article`. Пример: `"1"`, `"3"`.
- `paragraph` — пункт. В 7‑значный код не входит, но может использоваться как `article_parts`.
- `article_parts` — пункты/части статьи (`FS1R54P2`), строка через запятую.
  Пример: `"01,02"`.
- `crime_stage` — стадия преступления. Допустимые значения:
  - `"1"` — приготовление
  - `"2"` — покушение
  - `"3"` — оконченное
  Также допускаются: `preparation`, `prep`, `attempt`. По умолчанию `"3"`.
- `mitigating` — коды смягчающих (`FS1R571P1`), строка через запятую.
  Пример: `"01,03"`.
- `aggravating` — коды отягчающих (`FS1R572P1`), строка через запятую.
- `special_condition` — особые условия (`FS1R573P1`). Допустимые значения:
  - `""` — нет
  - `"01"`, `"02"`, `"03"`, `"04"`, `"05"`
- `has_mitigating` — булево. Если `true`, а `mitigating` не задан, используется `"1"`.
- `has_aggravating` — булево. Если `true`, а `aggravating` не задан, используется `"1"`.
- `fs1r56p1`, `fs1r571p1`, `fs1r572p1`, `fs1r573p1`,
  `fs1r041p1`, `fs1r042p1`, `fs1r23p1`, `fs1r26p1` — поля формы.
  Используются как альтернативный источник, если основные поля не заданы.

---

### Выход (response)

#### Верхний уровень
- `lang` — язык ответа (`ru`).
- `aNakaz` — строгий массив `15x13` (всегда 15 строк, 13 колонок).
- `structured` — человеко‑читабельная структура.

#### `aNakaz` — строки (индексы)
1. Штраф (`FS1R64=05`)
2. Исправительные работы (`FS1R64=06`)
3. Обязательные работы (`FS1R64=09`)
4. Ограничение свободы (`FS1R64=11`)
5. Арест (`FS1R64=12`)
6. Лишение свободы (`FS1R64=01`)
7. Смертная казнь (`FS1R64=02`)
8. Лишение звания/класса (`FS1R65=01`)
9. Запрет занимать должность (`FS1R65=04`)
10. Запрет заниматься деятельностью (`FS1R65=22`)
11. Лишение права (срок) (`FS1R65=02`)
12. Конфискация имущества (`FS1R65=05`)
13. Резерв (не используется)
14. Резерв (не используется)
15. Метаданные (проступок / отсутствие УО)

#### `aNakaz` — колонки (индексы)
1. `is_applicable` — применимо (bool)
2. `min` — минимальное значение (число)
3. `max` — максимальное значение (число)
4. `formatted_text` — строка (человекочитаемо)
5. `min_years` — для индексов 3 и 5
6. `min_months` — для индексов 3 и 5
7. `min_days` — для индексов 3 и 5
8. `max_years` — для индексов 3 и 5
9. `max_months` — для индексов 3 и 5
10. `max_days` — для индексов 3 и 5
11. внутренний код причины/ограничения (int)
12. служебный счётчик (используется для лишения свободы)
13. внутренний код ветки расчёта (int)

#### `structured.punishments`
Ключи:
`fine`, `corrective_work`, `mandatory_work`, `restriction_of_freedom`,
`arrest`, `imprisonment`, `death_penalty`.

Поля каждого наказания:
- `is_applicable` (bool)
- `min_value` (float)
- `max_value` (float)
- `formatted_text` (string)
- Для `restriction_of_freedom` и `imprisonment` дополнительно:
  - `min_years`, `min_months`, `min_days`, `max_years`, `max_months`, `max_days`

#### `structured.additional_punishments`
Ключи:
`confiscation`, `deportation`, `lifetime_prohibition`, `prohibition_term`,
`deprivation_of_citizenship`.

Поля:
- `is_applicable` (bool)
- `is_mandatory` (bool)
- `formatted_text` (string)
- Для `prohibition_term` дополнительно:
  - `min_years`, `max_years`

#### `structured.meta`
- `reference_found` — найдена ли статья в справочнике (bool)
- `is_misdemeanor` — признак «проступка» (bool)
- `no_criminal_liability` — отсутствие уголовной ответственности (bool)
- `reason` — причина (строка, если `no_criminal_liability=true`)

---

## GET `/api/article/?q=...`

### Вход (query)
- `q` — текст статьи. Поддерживаемые форматы:
  - `"188"`, `"188.3"`, `"ст. 188 ч.3"`, `"1880003"`

### Выход
- `success` — bool
- `article.code` — 7‑значный код `AAASSPP`
- `article.name` — отображаемое имя (обычно `stat` из справочника)
- `article.severity` — тяжесть:
  - `MINOR`, `SMALL`, `MEDIUM`, `SERIOUS`, `ESPECIALLY_SERIOUS`
- `article.imprisonment_min` — min лишения свободы (лет)
- `article.imprisonment_max` — max лишения свободы (лет)
- `article.is_excluded` — исключена ли статья (bool)

---

## GET `/reference/status`
- `source` — источник (обычно `file`)
- `count` — количество записей
- `file_path` — путь к справочнику

---

## POST `/reference/reload`
- `status` — строка `reloaded`
- `count` — количество записей
- `source` — источник

---

## GET `/health`
- `status` — `"ok"`
- `service` — `"punishment-api"`
- `version` — `"0.1.0"`
